{{ attach_library('dh_certificate/structure-monitor') }}

{#
/**
 * @file
 * Default theme implementation to display structure monitor detail.
 *
 * Available variables:
 * - monitor: The monitor information array.
 *   - id: The monitor ID.
 *   - title: The monitor title.
 *   - last_check: Timestamp of last check.
 *   - changes: Array of changes.
 *   - data: Current monitor data.
 *   - view_type: Either 'list' or 'record'.
 *   - record_id: (optional) The record ID if viewing a specific record.
 */
#}
<div class="structure-monitor-detail">
  <div class="monitor-actions">
    <a href="{{ path('dh_certificate.structure_monitor') }}" class="button">{{ 'Back to Overview'|t }}</a>
    {% if monitor.id == 'course' %}
      <a href="{{ path('dh_certificate.course_monitor.refresh') }}" class="button">{{ 'Refresh'|t }}</a>
    {% elseif monitor.id == 'profile' %}
      <a href="{{ path('dh_certificate.profile_monitor.refresh') }}" class="button">{{ 'Refresh'|t }}</a>
    {% elseif monitor.id == 'taxonomy' %}
      <a href="{{ path('dh_certificate.taxonomy_monitor.refresh') }}" class="button">{{ 'Refresh'|t }}</a>
    {% endif %}
  </div>

  <h2>{{ monitor.title }}</h2>
  
  {% if monitor.view_type == 'list' %}
    <div class="monitor-summary">
      <p>{{ 'Last checked: @time'|t({'@time': monitor.last_check|date('Y-m-d H:i:s')}) }}</p>
      
      {% if monitor.changes|length > 0 %}
        <h3>{{ 'Recent Changes'|t }}</h3>
        <ul class="changes-list">
          {% for change in monitor.changes %}
            <li>{{ change }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>{{ 'No changes detected.'|t }}</p>
      {% endif %}

      <h3>{{ 'Current Structure'|t }}</h3>
      <div class="current-structure">
        {% if monitor.data.fields is defined %}
          <h4>{{ 'Fields'|t }}</h4>
          <table>
            <thead>
              <tr>
                <th>{{ 'Name'|t }}</th>
                <th>{{ 'Type'|t }}</th>
                <th>{{ 'Required'|t }}</th>
              </tr>
            </thead>
            <tbody>
              {% for field_name, field in monitor.data.fields %}
                <tr>
                  <td>{{ field.label }}</td>
                  <td>{{ field.type }}</td>
                  <td>{{ field.required ? 'Yes'|t : 'No'|t }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}

        {% if monitor.data.vocabularies is defined %}
          <h4>{{ 'Vocabularies'|t }}</h4>
          <ul>
            {% for vocab_id, vocab_name in monitor.data.vocabularies %}
              <li>{{ vocab_name }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if monitor.data.displays is defined %}
          <h4>{{ 'Display Modes'|t }}</h4>
          <ul>
            {% for display_id, display in monitor.data.displays %}
              <li>
                {{ display_id }}
                {% if display.layout_builder_enabled is defined %}
                  ({{ 'Layout Builder enabled'|t }})
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>
  {% else %}
    {# Record view #}
    <div class="monitor-record">
      <h3>{{ 'Change Record'|t }} {{ monitor.record_id|date('Y-m-d H:i:s') }}</h3>
      {# Add record-specific display here #}
    </div>
  {% endif %}
</div>
